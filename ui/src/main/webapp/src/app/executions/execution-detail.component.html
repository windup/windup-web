<div *ngIf="!execution">
    <h2 i18n="Loading analysis heading|Analysis Page">Loading analysis data</h2>
</div>
<div *ngIf="execution">
    <h2 i18n="Heading|Analysis Page">Analysis #{{execution.id}}</h2>

    <div *ngIf="execution.state === 'QUEUED' || execution.state === 'STARTED'">
        <wu-progress-bar
                [taskName]="execution.currentTask"
                [currentValue]="execution.workCompleted"
                [minValue]="0"
                [maxValue]="execution.totalWork">
        </wu-progress-bar>
    </div>

    <wu-tab-container>
<!--    commenting for when the reports will have to be linked again
        <wu-tab [tabTitle]="'Available Reports'">
            <div *ngIf="!displayReportLinks">
                <div><wu-status-icon [status]="execution.state"></wu-status-icon>{{execution.state | wuPrettyExecutionStatus}}</div>
                <h2 i18n>Reports are only available for completed executions.</h2>
            </div>
            <ul *ngIf="displayReportLinks">
                <li><a [routerLink]="['../application-index']" i18n="report">Dashboard</a></li>
                <li><a [routerLink]="['../application-details']" i18n="report">Application Details</a></li>
                <li><a [routerLink]="['../migration-issues']" i18n="report">Issues</a></li>
                <li *ngIf="execution?.analysisContext?.generateStaticReports">
                    <a class="link external-link" target="_blank" href="{{formatStaticReportUrl(execution)}}">Static Reports</a>
                </li>
                <li *ngIf="!hideUnfinishedFeatures"><a [routerLink]="['../technology-report']" i18n="report">Technologies</a></li>
                <li *ngIf="!hideUnfinishedFeatures"><a [routerLink]="['../dependencies']" i18n="report">Dependencies</a></li>
            </ul>
        </wu-tab>
-->
        <wu-tab [tabTitle]="'Details'">
            <h3 i18n="Analysis status|Section">Status</h3>
            <dl>
                <dt i18n="Analysis status">Status:</dt>
                <dd><wu-status-icon [status]="execution.state"></wu-status-icon>{{execution.state | wuPrettyExecutionStatus}}</dd>
                <dt i18n="Analysis start date">Started:</dt>
                <dd>{{execution.timeStarted | date: 'short'}}</dd>
                <ng-container *ngIf="execution.timeCompleted">
<!--
                    <dt i18n="Analysis completion date">Completed Date</dt>
                    <dd>{{execution.timeCompleted | date: 'short'}}</dd>
-->
                    <dt i18n="Analysis duration">Duration:</dt>
                    <dd>{{ execution.timeCompleted - execution.timeStarted | wuDuration }}</dd>
                </ng-container>
                <ng-container *ngIf="!execution.timeCompleted">
                    <dt i18n="Analysis last modification">Last modification:</dt>
                    <dd>{{execution.lastModified | date: 'short'}}</dd>
                </ng-container>
            </dl>

            <h3 i18n="Analysis configuration|Section">Configuration</h3>
            <dl>
                <dt i18n="Migration Path">Migration path:</dt>
                <dd>{{execution.analysisContext?.migrationPath?.name}}</dd>

                <dt i18n="Analyzed applications">Analyzed applications:</dt>
                <dd *ngFor="let application of execution.filterApplications">{{application.fileName}}</dd>

                <dt i18n="Rules used for analysis">Rules:</dt>
                <dd *ngFor="let rulePath of execution.analysisContext.rulesPaths">{{rulePath.path}}</dd>
            </dl>

            <fieldset *ngIf="execution.analysisContext.includePackages.length > 0" class="fields-section-pf" id="includedPkgsSection">
                <legend class="fields-section-header-pf" aria-expanded="includedPkgsShow">
                    <span *ngIf="!includedPkgsShow" class="fa fa-angle-right field-section-toggle-pf"></span>
                    <span *ngIf="includedPkgsShow" class="fa fa-angle-right field-section-toggle-pf fa-angle-down"></span>
                    <a (click)="includedPkgsShow = !includedPkgsShow;" class="field-section-toggle-pf" i18n>Included packages</a>
                </legend>
                <div [hidden]="!includedPkgsShow" class="form-group">
                    <ul>
                        <li *ngFor="let package of execution.analysisContext.includePackages">{{package.fullName}}</li>
                    </ul>
                </div>
            </fieldset>

            <fieldset *ngIf="execution.analysisContext.excludePackages.length > 0" class="fields-section-pf" id="excludedPkgsSection">
                <legend class="fields-section-header-pf" aria-expanded="excludedPkgsShow">
                    <span *ngIf="!excludedPkgsShow" class="fa fa-angle-right field-section-toggle-pf"></span>
                    <span *ngIf="excludedPkgsShow" class="fa fa-angle-right field-section-toggle-pf fa-angle-down"></span>
                    <a (click)="excludedPkgsShow = !excludedPkgsShow;" class="field-section-toggle-pf" i18n>Excluded packages</a>
                </legend>
                <div [hidden]="!excludedPkgsShow" class="form-group">
                    <ul>
                        <li *ngFor="let package of execution.analysisContext.excludePackages">{{package.fullName}}</li>
                    </ul>
                </div>
            </fieldset>

        </wu-tab>
        <wu-tab [tabTitle]="'Advanced Options'">
            <h3 i18n="Advanced Options|Analysis">Advanced options</h3>
            <wu-analysis-context-advanced-options
                [(selectedOptions)]="execution.analysisContext.advancedOptions"
                [isReadOnly]="true"
            >
            </wu-analysis-context-advanced-options>
        </wu-tab>
        <wu-tab [tabTitle]="'Logs'">
            <wu-log-view [lines]="logLines"></wu-log-view>
        </wu-tab>
    </wu-tab-container>
</div>
